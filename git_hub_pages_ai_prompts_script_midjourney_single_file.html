<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompts & Script Studio</title>
  <style>
    :root{
      --bg:#f7f8fb;--card:#ffffff;--muted:#6b7280;--accent:#111827;--glass:rgba(255,255,255,0.6);
      --radius:12px; --shadow: 0 6px 20px rgba(16,24,40,0.06);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#f7f8fb 0%, #eef2f7 100%);color:#0f172a;display:flex;align-items:flex-start;justify-content:center;padding:28px;
    }
    .wrap{width:100%;max-width:980px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#eef2ff,#fff);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);box-shadow:var(--shadow)}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .tabs{display:flex;gap:8px;margin:12px 0 16px}
    .tab{padding:8px 12px;border-radius:10px;background:transparent;color:var(--muted);cursor:pointer;border:1px solid transparent}
    .tab.active{background:linear-gradient(180deg,#fff,#f3f7ff);color:var(--accent);border-color:#e6eefc}

    .grid{display:grid;grid-template-columns:1fr 320px;gap:14px}
    .main{min-height:420px}
    .side{display:flex;flex-direction:column;gap:12px}

    textarea,input[type='text']{width:100%;padding:12px;border-radius:10px;border:1px solid #e6e9ef;background:transparent;font-size:14px;resize:vertical}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .row{display:flex;gap:10px;align-items:center}
    .small{font-size:12px;color:var(--muted)}

    .chapter{margin-bottom:10px}
    .chapter h4{margin:0 0 6px;font-size:14px}
    .meta{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .btn{padding:8px 12px;border-radius:10px;border:0;background:#0f172a;color:#fff;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid #e6e9ef}
    .danger{background:#ef4444}
    .controls{display:flex;gap:8px;flex-wrap:wrap}

    .confirm{background:#fff8f8;border:1px solid #ffdddd;padding:10px;border-radius:10px;color:#7f1d1d}
    pre{white-space:pre-wrap;word-break:break-word;background:linear-gradient(180deg,#fbfcff,#fff);padding:12px;border-radius:10px;border:1px solid #eef2f7}

    footer{margin-top:12px;font-size:12px;color:var(--muted)}

    @media (max-width:900px){.grid{grid-template-columns:1fr;margin-bottom:40px}.side{order:2}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">G</div>
      <div>
        <h1>Prompts & Script Studio</h1>
        <p class="lead">AI Prompts, Script (chaptered), Midjourney prompts — saved locally in your browser.</p>
      </div>
    </header>

    <div class="card">
      <div class="tabs" id="tabs">
        <button class="tab active" data-tab="ai">AI Prompts</button>
        <button class="tab" data-tab="script">Script</button>
        <button class="tab" data-tab="mid">Midjourney Prompts</button>
        <button class="tab" data-tab="combined">Combined Script</button>
      </div>

      <div class="grid">
        <div class="main" id="main-content">
          <!-- dynamic content here -->
        </div>

        <aside class="side">
          <div class="card">
            <label>Auto-save</label>
            <div class="row" style="align-items:center;justify-content:space-between">
              <div class="small" id="autosaveState">Auto-save: On</div>
              <div class="controls">
                <button class="btn ghost" id="saveNow">Save now</button>
                <button class="btn ghost" id="exportBtn">Export .txt</button>
              </div>
            </div>
            <hr style="margin:10px 0;border:none;border-top:1px solid #f1f5f9">
            <label>Storage</label>
            <div class="small">Saved to <code>localStorage</code>. Reset clears all saved fields.</div>
            <div style="margin-top:8px" class="row">
              <button id="resetBtn" class="btn danger">Reset All</button>
            </div>
            <div id="confirmReset" style="display:none;margin-top:8px" class="confirm">
              Are you sure? This will permanently delete saved prompts and scripts.
              <div style="margin-top:8px;display:flex;gap:8px">
                <button id="confirmYes" class="btn danger">Yes, reset</button>
                <button id="confirmNo" class="btn ghost">Cancel</button>
              </div>
            </div>
          </div>

          <div class="card">
            <label>Quick tips</label>
            <div class="small">
              • Script chapters auto-sync to Midjourney tab. <br>
              • Chapter 0 = Intro. <br>
              • Use "Export" to download the active tab's text.
            </div>
          </div>
        </aside>
      </div>

      <footer>Made for GitHub Pages — save this file as <code>index.html</code> in your repo and enable Pages (or open locally).</footer>
    </div>
  </div>

  <script>
    // Keys
    const KEY_AI = 'ghp_ai_prompts_v1';
    const KEY_SCRIPT = 'ghp_script_chapters_v1';
    const KEY_MID = 'ghp_mid_chapters_v1';
    const AUTO_SAVE = true;

    // App state
    let state = {
      active: 'ai',
      aiText: '',
      chapters: 3,
      script: [],
      mid: [],
      autosave: AUTO_SAVE
    };

    // DOM refs
    const tabsEl = document.getElementById('tabs');
    const main = document.getElementById('main-content');
    const autosaveState = document.getElementById('autosaveState');
    const saveNow = document.getElementById('saveNow');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');
    const confirmReset = document.getElementById('confirmReset');
    const confirmYes = document.getElementById('confirmYes');
    const confirmNo = document.getElementById('confirmNo');

    // init
    function load() {
      const ai = localStorage.getItem(KEY_AI);
      const script = localStorage.getItem(KEY_SCRIPT);
      const mid = localStorage.getItem(KEY_MID);
      if (ai) state.aiText = ai;
      if (script) try{ state.script = JSON.parse(script);}catch(e){}
      if (mid) try{ state.mid = JSON.parse(mid);}catch(e){}

      if (!Array.isArray(state.script) || state.script.length===0){
        state.script = [''];
      }
      if (!Array.isArray(state.mid) || state.mid.length===0){
        state.mid = [''];
      }
      state.chapters = Math.max(state.script.length-1, 0) + 1; // ensure at least chapter 0
    }

    function save() {
      localStorage.setItem(KEY_AI, state.aiText || '');
      localStorage.setItem(KEY_SCRIPT, JSON.stringify(state.script));
      localStorage.setItem(KEY_MID, JSON.stringify(state.mid));
    }

    // helper: word count
    function countWords(str){
      if(!str) return 0;
      return (str.trim().match(/\S+/g)||[]).length;
    }

    // render
    function render(){
      // tabs active
      [...tabsEl.querySelectorAll('.tab')].forEach(b=>b.classList.toggle('active', b.dataset.tab===state.active));

      if(state.active==='ai') renderAI();
      if(state.active==='script') renderScript();
      if(state.active==='mid') renderMid();
      if(state.active==='combined') renderCombined();
    }

    // AI Tab
    function renderAI(){
      main.innerHTML = `
        <div class="card">
          <label>AI Prompts (free-form)</label>
          <textarea id="aiText" rows="12" placeholder="Paste or type your prompts here...">${escapeHTML(state.aiText)}</textarea>
          <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
            <div class="small">Characters: ${state.aiText.length}</div>
            <div class="controls"><button class="btn" id="clearAI">Clear</button></div>
          </div>
        </div>
      `;

      const ta = document.getElementById('aiText');
      ta.addEventListener('input', (e)=>{
        state.aiText = e.target.value; updateSide(); if(state.autosave) debounceSave();
        render();
      });
      document.getElementById('clearAI').addEventListener('click', ()=>{ if(confirm('Clear AI prompts?')){ state.aiText=''; ta.value=''; save(); render(); }});
    }

    // Script Tab
    function renderScript(){
      // ensure arrays length equals chapters+? We keep chapter 0 included
      if(state.script.length < state.chapters+0) {
        while(state.script.length < state.chapters) state.script.push('');
      }
      // build UI
      let html = `<div class="card"><div class="row"><div style="flex:1"><label>Number of chapters (including Chapter 0 — intro)</label><input id="chapNum" type="number" min="1" value="${state.chapters}" /></div>
        <div style="width:160px"><label>Quick actions</label><div class="row"><button id="addChap" class="btn ghost">+ Chapter</button><button id="removeChap" class="btn ghost">-</button></div></div></div><hr style="margin:12px 0;border:none;border-top:1px solid #f3f6fb">`;

      state.script.forEach((text,i)=>{
        html += `<div class="chapter"><h4>Chapter ${i}</h4><div class="meta"><div class="small">Words: ${countWords(text)}</div></div><textarea data-idx="${i}" rows="6" placeholder="Chapter ${i} text...">${escapeHTML(text)}</textarea></div>`;
      });

      html += `<div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end"><button id="combineBtn" class="btn">Preview Combined</button></div></div>`;
      main.innerHTML = html;

      // events
      document.getElementById('chapNum').addEventListener('change', (e)=>{
        let val = parseInt(e.target.value)||1;
        val = Math.max(1,val);
        adjustChapters(val);
      });
      document.getElementById('addChap').addEventListener('click', ()=>adjustChapters(state.chapters+1));
      document.getElementById('removeChap').addEventListener('click', ()=>adjustChapters(Math.max(1,state.chapters-1)));

      document.querySelectorAll('textarea[data-idx]').forEach(el=>{
        el.addEventListener('input',(e)=>{
          const i = parseInt(e.target.dataset.idx);
          state.script[i] = e.target.value;
          // sync mid array size
          ensureMidSync();
          updateSide();
          if(state.autosave) debounceSave();
          // update word count display (cheap way: rerender)
          render();
        });
      });

      document.getElementById('combineBtn').addEventListener('click', ()=>{ state.active='combined'; render(); });
    }

    function adjustChapters(val){
      const old = state.chapters;
      if(val === old) return;
      // preserve existing chapters as much as possible
      if(val > old){
        for(let i=0;i<val-old;i++) state.script.push('');
      } else {
        // truncate
        state.script = state.script.slice(0,val);
      }
      state.chapters = val;
      ensureMidSync();
      if(state.autosave) debounceSave();
      render();
    }

    function ensureMidSync(){
      // ensure mid array matches script length
      const need = state.script.length;
      if(state.mid.length < need){
        while(state.mid.length < need) state.mid.push('');
      } else if(state.mid.length > need){
        state.mid = state.mid.slice(0,need);
      }
    }

    // Midjourney Tab
    function renderMid(){
      ensureMidSync();
      let html = `<div class="card"><label>Midjourney Prompts (mirrors script chapters)</label>`;
      state.mid.forEach((text,i)=>{
        html += `<div class="chapter"><h4>Chapter ${i}</h4><div class="meta"><div class="small">Words: ${countWords(text)}</div></div><textarea data-mid-idx="${i}" rows="4" placeholder="Midjourney prompt for Chapter ${i}...">${escapeHTML(text)}</textarea></div>`;
      });
      html += `<div style="display:flex;justify-content:flex-end;gap:8px"><button id="syncToScript" class="btn ghost">Copy script -> mid</button></div></div>`;
      main.innerHTML = html;

      document.querySelectorAll('textarea[data-mid-idx]').forEach(el=>{
        el.addEventListener('input',(e)=>{
          const i = parseInt(e.target.dataset.midIdx);
          state.mid[i] = e.target.value;
          if(state.autosave) debounceSave();
          render();
        });
      });
      document.getElementById('syncToScript').addEventListener('click', ()=>{
        // simple: copy first 200 chars of script to mid
        state.mid = state.script.map(s => s ? s.split('\n').slice(0,3).join(' ').slice(0,400) : '');
        if(state.autosave) debounceSave();
        render();
      });
    }

    // Combined Tab
    function renderCombined(){
      // combine with a single blank line between chapters
      ensureMidSync();
      const combined = state.script.map(s=>s||'').join('\n\n');
      const wc = countWords(combined);
      main.innerHTML = `<div class="card"><label>Combined Script (all chapters concatenated)</label><pre id="combinedPre">${escapeHTML(combined)}</pre><div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center"><div class="small">Total words: ${wc}</div><div><button id="copyCombined" class="btn ghost">Copy</button><button id="downloadCombined" class="btn">Download</button></div></div></div>`;
      document.getElementById('copyCombined').addEventListener('click', ()=>{copyText(document.getElementById('combinedPre').innerText);});
      document.getElementById('downloadCombined').addEventListener('click', ()=>{ downloadText('combined_script.txt', combined); });
    }

    // utilities
    function escapeHTML(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    function copyText(t){ navigator.clipboard?.writeText(t).then(()=>alert('Copied to clipboard')) }
    function downloadText(filename, text){ const a=document.createElement('a'); a.href='data:text/plain;charset=utf-8,'+encodeURIComponent(text); a.download=filename; a.click(); }

    // debounce
    let saveTimer = null;
    function debounceSave(){ clearTimeout(saveTimer); saveTimer = setTimeout(()=>{ save(); updateSide(); }, 800); }

    // side actions
    saveNow.addEventListener('click', ()=>{ save(); alert('Saved to localStorage'); });
    exportBtn.addEventListener('click', ()=>{ // export active tab content
      if(state.active==='ai'){ downloadText('ai_prompts.txt', state.aiText||''); }
      else if(state.active==='script'){ downloadText('script_chapters.txt', state.script.join('\n\n')); }
      else if(state.active==='mid'){ downloadText('mid_prompts.txt', state.mid.join('\n\n')); }
      else if(state.active==='combined'){ downloadText('combined_script.txt', state.script.join('\n\n')); }
    });

    resetBtn.addEventListener('click', ()=>{ confirmReset.style.display='block'; });
    confirmNo.addEventListener('click', ()=>{ confirmReset.style.display='none'; });
    confirmYes.addEventListener('click', ()=>{ localStorage.removeItem(KEY_AI); localStorage.removeItem(KEY_SCRIPT); localStorage.removeItem(KEY_MID); state.aiText=''; state.script=['']; state.mid=['']; state.chapters=1; confirmReset.style.display='none'; render(); alert('All data cleared.'); });

    // tab switching
    tabsEl.addEventListener('click',(e)=>{
      const b = e.target.closest('.tab'); if(!b) return; state.active = b.dataset.tab; render();
    });

    // update side info
    function updateSide(){ autosaveState.innerText = `Auto-save: ${state.autosave ? 'On' : 'Off'}`; }

    // export helper
    function downloadActive(){ exportBtn.click(); }

    // initial load
    load(); render();

    // small accessibility: keyboard shortcuts
    document.addEventListener('keydown',(e)=>{
      if(e.ctrlKey && e.key==='s'){ e.preventDefault(); save(); alert('Saved'); }
    });

  </script>
</body>
</html>